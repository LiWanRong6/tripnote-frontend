import{bH as N,a as S,R as E,o as n,c as l,e as s,b as f,aG as a,w as h,U as g,aB as y,V as w,aC as u,S as c,aI as L,W as T,d as v,al as $,bI as A,bJ as K,aD as U,aH as H}from"./index.246037ca.js";const M={id:"Itinerary"},R={id:"image-block"},F={class:"container"},G={class:"header"},J={class:"title"},W={class:"user-time"},X=w("Created By "),j={class:"item-list"},q=["onDrop"],z=s("hr",null,null,-1),O=["onDragstart"],P={class:"item-list-card"},Q={class:"item-list-left"},Y=w("X"),Z={class:"content"},tt={key:0},et=["onUpdate:modelValue","onKeydown"],st=["onDblclick"],it={class:"addAttractionBtn"},ot={class:"totalSpend"},ct={__name:"ItineraryView",setup(rt){const D=N(),t=S({_id:"",user:"",title:"",image:[],departure:"",return:"",created:"",post:"",ispost:"",item:[],Item_id:"",rows:[],edit:!1}),x=async()=>{t.ispost=!t.ispost;try{await u.patch("/tripnotes/post/"+t._id,t),t.ispost?c.fire({icon:"success",title:"\u6210\u529F",text:"\u5206\u4EAB\u6210\u529F"}):c.fire({icon:"success",title:"\u6210\u529F",text:"\u53D6\u6D88\u5206\u4EAB"})}catch{c.fire({icon:"error",title:"\u5931\u6557",text:"\u5206\u4EAB\u5931\u6557"})}},I=async i=>{try{for(let e=0;e<t.item.length;e++)t.item[e]._id==i._id&&t.item.splice(e,1);await u.patch("/tripnotes/item/"+t._id,t),c.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"})}catch{c.fire({icon:"error",title:"\u5931\u6557",text:"\u522A\u9664\u5931\u6557"})}},k=async i=>{for(let e=0;e<t.item.length;e++)t.item[e]._id==i._id&&(t.item[e].edit=!t.item[e].edit)},b=async i=>{try{for(let e=0;e<t.item.length;e++)t.item[e]._id==i._id&&(t.item[e].edit=!t.item[e].edit,t.item[e].spend=Number(t.item[e].spend));await u.patch("/tripnotes/item/"+t._id,t),c.fire({icon:"success",title:"\u6210\u529F",text:"\u4FEE\u6539\u6210\u529F"})}catch{c.fire({icon:"error",title:"\u5931\u6557",text:"\u4FEE\u6539\u5931\u6557"})}},B=i=>t.item.filter(e=>e.list==i),C=(i,e)=>{i.dataTransfer.dropEffect="move",i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("ItemId",e._id)},V=async(i,e)=>{const r=i.dataTransfer.getData("ItemId"),p=t.item.find(m=>m._id==r);p.list=e,await u.patch("/tripnotes/item/"+t._id,t)};return(async()=>{try{let i=0;const{data:e}=await u.get("/tripnotes/"+D.params.id);t._id=e.result._id,t.title=e.result.title,t.image=e.result.image,t.departure=e.result.date[0].departure,t.return=e.result.date[0].return,t.created=e.result.date[0].created,t.post=e.result.user.post,t.user=e.result.user.account,t.ispost=e.result.ispost,t.item=e.result.item,t.item.forEach(r=>r.idx=i++),t.item.forEach(r=>r.edit=!1);for(let r=0;r<=(new Date(t.return).getTime()-new Date(t.departure).getTime())/(1e3*60*60*24)+2;r++)r===0?t.rows.push({id:r,title:"\u672A\u6392\u5E8F"}):t.rows.push({id:r,title:"Day"+r})}catch{c.fire({icon:"error",title:"\u5931\u6557",text:"\u8F09\u5165\u932F\u8AA4"})}})(),(i,e)=>{const r=L,p=E("font-awesome-icon"),m=T;return n(),l("div",M,[s("div",R,[f(r,{src:t.image},null,8,["src"])]),s("div",F,[s("div",G,[s("div",J,[s("h1",null,a(t.title),1),s("h2",null,a(new Date(t.departure).toLocaleDateString())+" - "+a(new Date(t.return).toLocaleDateString()),1)]),f(m,{onClick:x},{default:h(()=>[f(p,{icon:"fa-solid fa-share-nodes"})]),_:1})]),s("div",W,[s("p",null,[X,s("a",null,[s("span",null,a(t.user),1)])]),s("p",null,a(new Date(t.created).toLocaleDateString()),1)]),s("div",j,[(n(!0),l(g,null,y(t.rows,d=>(n(),l("div",{key:d.id,onDrop:o=>V(o,d.id),onDragenter:e[0]||(e[0]=v(()=>{},["prevent"])),onDragover:e[1]||(e[1]=v(()=>{},["prevent"]))},[s("h2",null,a(d.title),1),z,(n(!0),l(g,null,y(B(d.id),o=>(n(),l("div",{key:o._id,draggable:"true",onDragstart:_=>C(_,o)},[s("div",P,[s("div",Q,[f(m,{onClick:_=>I(o)},{default:h(()=>[Y]),_:2},1032,["onClick"]),s("div",Z,[s("h3",null,a(o.attraction.name),1),s("p",null,a(o.attraction.address),1)])]),o.edit?(n(),l("div",tt,[$(s("input",{"onUpdate:modelValue":_=>o.spend=_,type:"text",onKeydown:K(_=>b(o),["enter"])},null,40,et),[[A,o.spend]])])):(n(),l("div",{key:1,class:"item-list-right",onDblclick:_=>k(o)},"$"+a(o.spend),41,st))])],40,O))),128)),s("div",it,[d.id!=0?(n(),U(p,{key:0,icon:"fa-solid fa-circle-plus"})):H("",!0)])],40,q))),128))]),s("p",ot,"\u65C5\u884C\u7E3D\u82B1\u8CBB\uFF1A"+a(t.item.reduce((d,o)=>d+o.spend,0)),1)])])}}};export{ct as default};
