import{bm as V,a as C,b as g,o,c as l,d as s,e as _,ao as n,w as h,F as w,ah as D,g as v,aj as m,S as f,aq as E,f as y,ak as L,al as $,bn as A,am as K,ap as F,ar as M}from"./index.e831b955.js";const U={id:"Itinerary"},j={id:"image-block"},q={class:"container"},R={class:"header"},X={class:"title"},z={class:"user-time"},G=v("Created By "),H={class:"item-list"},J=["onDrop"],O=s("hr",null,null,-1),P=["onDragstart"],Q={class:"item-list-card"},W={class:"item-list-left"},Y=v("X"),Z={class:"content"},tt={key:0},et=["onUpdate:modelValue","onKeydown"],st=["onDblclick"],it={class:"addAttractionBtn"},rt={class:"totalSpend"},dt={__name:"ItineraryView",setup(at){const k=V(),t=C({_id:"",user:"",title:"",image:[],departure:"",return:"",created:"",post:"",ispost:"",item:[],Item_id:"",rows:[],edit:!1}),I=async r=>{try{for(let e=0;e<t.item.length;e++)t.item[e]._id==r._id&&t.item.splice(e,1);await m.patch("/tripnotes/item/"+t._id,t),f.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"})}catch{f.fire({icon:"error",title:"\u5931\u6557",text:"\u522A\u9664\u5931\u6557"})}},x=async r=>{for(let e=0;e<t.item.length;e++)t.item[e]._id==r._id&&(t.item[e].edit=!t.item[e].edit)},b=async r=>{try{for(let e=0;e<t.item.length;e++)t.item[e]._id==r._id&&(t.item[e].edit=!t.item[e].edit,t.item[e].spend=Number(t.item[e].spend));await m.patch("/tripnotes/item/"+t._id,t)}catch{f.fire({icon:"error",title:"\u5931\u6557",text:"\u4FEE\u6539\u5931\u6557"})}},N=r=>t.item.filter(e=>e.list==r),T=(r,e)=>{r.dataTransfer.dropEffect="move",r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("ItemId",e._id)},B=async(r,e)=>{const i=r.dataTransfer.getData("ItemId"),u=t.item.find(p=>p._id==i);u.list=e,await m.patch("/tripnotes/item/"+t._id,t)};return(async()=>{try{let r=0;const{data:e}=await m.get("/tripnotes/"+k.params.id);if(t._id=e.result._id,t.title=e.result.title,t.image=e.result.image,t.departure=e.result.date[0].departure,t.return=e.result.date[0].return,t.created=e.result.date[0].created,t.post=e.result.user.post,t.user=e.result.user.account,t.ispost=e.result.ispost,t.item=e.result.item,t.item.forEach(i=>i.idx=r++),t.item.forEach(i=>i.edit=!1),(new Date(t.return).getTime()-new Date(t.departure).getTime())/(1e3*60*60*24)==0)for(let i=0;i<=(new Date(t.return).getTime()-new Date(t.departure).getTime())/(1e3*60*60*24)+1;i++)i===0?t.rows.push({id:i,title:"\u672A\u6392\u5E8F"}):t.rows.push({id:i,title:"Day"+i});else for(let i=0;i<=(new Date(t.return).getTime()-new Date(t.departure).getTime())/(1e3*60*60*24)+2;i++)i===0?t.rows.push({id:i,title:"\u672A\u6392\u5E8F"}):t.rows.push({id:i,title:"Day"+i})}catch{f.fire({icon:"error",title:"\u5931\u6557",text:"\u8F09\u5165\u932F\u8AA4"})}})(),(r,e)=>{const i=E,u=g("font-awesome-icon"),p=M,S=g("router-link");return o(),l("div",U,[s("div",j,[_(i,{src:t.image},null,8,["src"])]),s("div",q,[s("div",R,[s("div",X,[s("h1",null,n(t.title),1),s("h2",null,n(new Date(t.departure).toLocaleDateString())+" - "+n(new Date(t.return).toLocaleDateString()),1)]),_(S,{to:"/edit-share-tripnote/"+t._id},{default:h(()=>[_(p,null,{default:h(()=>[_(u,{icon:"fa-solid fa-share-nodes"})]),_:1})]),_:1},8,["to"])]),s("div",z,[s("p",null,[G,s("a",null,[s("span",null,n(t.user),1)])]),s("p",null,n(new Date(t.created).toLocaleDateString()),1)]),s("div",H,[(o(!0),l(w,null,D(t.rows,d=>(o(),l("div",{key:d.id,onDrop:a=>B(a,d.id),onDragenter:e[0]||(e[0]=y(()=>{},["prevent"])),onDragover:e[1]||(e[1]=y(()=>{},["prevent"]))},[s("h2",null,n(d.title),1),O,(o(!0),l(w,null,D(N(d.id),a=>(o(),l("div",{key:a._id,draggable:"true",onDragstart:c=>T(c,a)},[s("div",Q,[s("div",W,[_(p,{onClick:c=>I(a)},{default:h(()=>[Y]),_:2},1032,["onClick"]),s("div",Z,[s("h3",null,n(a.attraction.name),1),s("p",null,n(a.attraction.address),1)])]),a.edit?(o(),l("div",tt,[L(s("input",{"onUpdate:modelValue":c=>a.spend=c,type:"text",onKeydown:A(c=>b(a),["enter"])},null,40,et),[[$,a.spend]])])):(o(),l("div",{key:1,class:"item-list-right",onDblclick:c=>x(a)},"$"+n(a.spend),41,st))])],40,P))),128)),s("div",it,[d.id!=0?(o(),K(u,{key:0,icon:"fa-solid fa-circle-plus"})):F("",!0)])],40,J))),128))]),s("p",rt,"\u65C5\u884C\u7E3D\u82B1\u8CBB\uFF1A"+n(t.item.reduce((d,a)=>Number(d)+Number(a.spend),0)),1)])])}}};export{dt as default};
