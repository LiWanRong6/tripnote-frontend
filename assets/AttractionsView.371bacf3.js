import{a as _,b as N,o as S,c as E,d as u,e as n,w as l,ai as $,bs as q,z as c,aq as j,aj as p,S as d,ar as f,f as D,g as w}from"./index.7fcf744d.js";import{_ as F,a as I}from"./text.2e12c032.js";import{a as R,_ as T}from"./Upload.40202096.js";import{_ as G}from"./DataTable.8b2ed3da.js";import{_ as H}from"./Input.c95fed6e.js";import{a as J,_ as K}from"./FormItem.48fa749e.js";import{_ as L}from"./Spin.277b387f.js";import"./FocusDetector.87a9797a.js";import"./fade-in-height-expand.cssr.2f76ee2e.js";import"./RadioGroup.7c77ecb5.js";const O={id:"AdminAttraction"},P={class:"container"},Q={id:"header"},W=u("h1",null,"\u666F\u9EDE\u7BA1\u7406",-1),X=w("\u65B0\u589E\u666F\u9EDE"),Y={style:{"margin-bottom":"12px"}},Z=w(" \u9EDE\u64CA\u6216\u62D6\u66F3\u5716\u7247\u5230\u6B64\u5340\u57DF "),tt=u("input",{type:"submit",value:"\u78BA\u8A8D"},null,-1),pt={__name:"AttractionsView",setup(et){const i=_([]);console.log(i);const e=_({_id:"",name:"",address:"",longitude:"",latitude:"",image:[],description:"",official:"",phone:"",idx:-1,showModal:!1,formValid:!1,submitting:!1}),b=_({name:[{required:!0,message:"\u666F\u9EDE\u540D\u7A31\u5FC5\u586B",trigger:"blur"}]}),h=async()=>{e.submitting=!0;const o=new FormData;for(const t in e)["_id","idx","formValid","showModal","submitting"].includes(t)||(t==="image"?e.image.length>0&&o.append(t,e[t][0].file):o.append(t,e[t]));try{if(e._id.length===0){const{data:t}=await p.post("/attractions",o);console.log(o),i.push(t.result),d.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:t}=await p.patch("/attractions/"+e._id,o);i[e.idx]=t.result,d.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.showModal=!1}catch(t){console.log(t),e.showModal=!1,d.fire({icon:"error",title:"\u5931\u6557",text:"\u65B0\u589E\u5931\u6557"})}e.submitting=!1},y=async o=>{d.fire({icon:"warning",title:"\u78BA\u5B9A\u522A\u9664?",showCancelButton:!0,cancelButtonColor:"#d33"}).then(async t=>{t.isConfirmed&&(await p.delete("/attractions/"+o),await d.fire({icon:"success",title:"\u6210\u529F"}),v())}).catch(t=>{d.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})})},g=(o,t)=>{e._id=o,t>-1?(e.name=i[t].name,e.address=i[t].address,e.longitude=i[t].longitude,e.latitude=i[t].latitude,e.description=i[t].description,e.official=i[t].official,e.phone=i[t].phone):(e.name="",e.address="",e.longitude="",e.latitude="",e.description="",e.official="",e.phone=""),e.image=[],e.idx=t,e.showModal=!0,e.formValid=!1,e.submitting=!1},x=_([{title:"\u5716\u7247",key:"image",render(o){return c(j,{width:"100",src:o.image})}},{title:"\u666F\u9EDE",key:"name"},{title:"\u5730\u5740",key:"address"},{title:"\u5B98\u7DB2",key:"official"},{title:"\u96FB\u8A71",key:"phone"},{title:"\u7DE8\u8F2F",key:"edit",render(o){return c(f,{strong:!0,tertiary:!0,size:"small",onClick:()=>g(o._id,o.idx)},{default:()=>"\u7DE8\u8F2F"})}},{title:"\u522A\u9664",key:"delete",render(o){return c(f,{strong:!0,tertiary:!0,size:"small",class:"bg-red",onClick:()=>y(o._id)},{default:()=>"\u522A\u9664"})}}]),m=_({pageSize:5}),v=async()=>{try{let o=0;const{data:t}=await p.get("/attractions/all");i.push(...t.result),console.log(i),i.forEach(s=>{s.idx=o++})}catch(o){d.fire({icon:"error",title:"\u5931\u6557",text:o.isAxiosError?o.response.data.message:o.message})}};return v(),(o,t)=>{const s=H,r=J,k=N("font-awesome-icon"),M=I,U=R,A=T,C=L,V=K,B=F,z=G;return S(),E("div",O,[u("div",P,[u("div",Q,[W,n($(f),{class:"addBtn",onClick:t[0]||(t[0]=a=>g("",-1))},{default:l(()=>[X]),_:1})]),n(B,{show:e.showModal,"onUpdate:show":t[10]||(t[10]=a=>e.showModal=a),"mask-closable":!1,preset:"card",title:e._id.length>0?"\u7DE8\u8F2F\u666F\u9EDE\u8CC7\u8A0A":"\u65B0\u589E\u666F\u9EDE\u8CC7\u8A0A",style:{width:"500px"}},{default:l(()=>[n(V,{ref:"formValid","label-placement":"left",model:e,rules:b,onSubmit:D(h,["prevent"])},{default:l(()=>[n(r,{label:"\u540D\u7A31",path:"name"},{default:l(()=>[n(s,{value:e.name,"onUpdate:value":t[1]||(t[1]=a=>e.name=a)},null,8,["value"])]),_:1}),n(r,{label:"\u5730\u5740"},{default:l(()=>[n(s,{value:e.address,"onUpdate:value":t[2]||(t[2]=a=>e.address=a)},null,8,["value"])]),_:1}),n(r,{label:"\u7D93\u5EA6"},{default:l(()=>[n(s,{value:e.longitude,"onUpdate:value":t[3]||(t[3]=a=>e.longitude=a)},null,8,["value"])]),_:1}),n(r,{label:"\u7DEF\u5EA6"},{default:l(()=>[n(s,{value:e.latitude,"onUpdate:value":t[4]||(t[4]=a=>e.latitude=a)},null,8,["value"])]),_:1}),n(r,{label:"\u5716\u7247"},{default:l(()=>[n(A,{"file-list":e.image,"onUpdate:file-list":t[5]||(t[5]=a=>e.image=a),accept:"image/*","directory-dnd":"",max:1},{default:l(()=>[n(U,null,{default:l(()=>[u("div",Y,[n(k,{icon:"fa-solid fa-image"})]),n(M,{style:{"font-size":"16px"}},{default:l(()=>[Z]),_:1})]),_:1})]),_:1},8,["file-list"])]),_:1}),n(r,{label:"\u6558\u8FF0"},{default:l(()=>[n(s,{type:"textarea",value:e.description,"onUpdate:value":t[6]||(t[6]=a=>e.description=a),maxlength:"200","show-count":""},null,8,["value"])]),_:1}),n(r,{label:"\u5B98\u7DB2"},{default:l(()=>[n(s,{value:e.official,"onUpdate:value":t[7]||(t[7]=a=>e.official=a)},null,8,["value"])]),_:1}),n(r,{label:"\u96FB\u8A71"},{default:l(()=>[n(s,{value:e.phone,"onUpdate:value":t[8]||(t[8]=a=>e.phone=a)},null,8,["value"])]),_:1}),n(r,null,{default:l(()=>[u("input",{type:"button",onClick:t[9]||(t[9]=a=>e.showModal=!1),value:"\u53D6\u6D88"}),n(C,{show:e.submitting},{default:l(()=>[tt]),_:1},8,["show"])]),_:1})]),_:1},8,["model","rules","onSubmit"])]),_:1},8,["show","title"]),n(z,{columns:x,data:i,bordered:!1,pagination:m,"onUpdate:pagination":t[11]||(t[11]=a=>q(m)?m.value=a:null)},null,8,["columns","data","pagination"])])])}}};export{pt as default};
